# 작업 로그 - 04: 에디터 및 내보내기 핵심 버그 픽스

**작업일자**: 2026-02-25
**작업자**: Antigravity (해결자)
**요약**: 초기 로드시 Undo/Redo 기능 무반응, 내보내기 드롭다운의 마우스 호버 이슈, HTML 내보내기 시 다이어그램 누락, 그리고 '/' 슬래시 커맨드 클릭 무반응 버그 등 네 가지 주요 버그를 수정했습니다.

## 1. 이슈 사항 및 요구사항 명세
- **Undo/Redo 무반응 및 편의성**: Cmd+Z 단축키나 버튼을 눌러도 초기 에디터 상태가 저장되지 않아 무반응인 현상, 그리고 Mac 환경에서 자주 쓰이는 Cmd+Shift+Z 키 (Redo) 지원 누락 이슈.
- **내보내기 메뉴의 불안정성**: 최상단 툴바의 `내보내기` 버튼에 마우스를 올렸을 때 나타나는 하위 메뉴가, 버튼과 메뉴 사이의 빈 마진(gap)으로 인해 닫혀버리는 현상.
- **HTML 다이어그램 누락**: 작성한 마크다운을 HTML 파일로 저장하여 열어보면 다이어그램이 텍스트 코드 블록으로만 보이고 렌더링되지 않음.
- **Slash 커맨드 무반응**: '/' 기호를 입력하고 나타나는 슬래시 메뉴에서 특정 아이템에 마우스 클릭을 해도 명령어가 실행되지 않고 무시되는 경우가 빈번함.

## 2. 해결 방안 및 구현 내용

### 2.1 Undo/Redo 초기 상태 저장 및 단축키 추가
- **[수정] `js/editor/editor-manager.js`**
  - 앱이 처음 시작할 때 호출되는 `loadLastDocument()` 및 컨텐츠 초기화 영역에 `this.saveHistoryState()`를 직접 호출하여 **빈 화면이나 초기 튜토리얼 텍스트 상태를 인덱스 '0'에 강제로 저장**하도록 수정했습니다.
  - 키보드 이벤트 핸들러에서 `Ctrl/Cmd + Z` 가 눌렸을 때 `e.shiftKey` 여부를 함께 파악하여, Shift가 포함되어 있다면 `this.redo()`를, 아니라면 `this.undo()`를 수행하도록 Mac 사용자 친화적으로 업데이트했습니다.

### 2.2 내보내기 Hover 안정성 개선
- **[수정] `index.html`**
  - 버튼 드롭다운 컨테이너에 지정된 `mt-2`(margin-top: 0.5rem) 클래스를 제거하고, 대신 `top-full pt-2` 구조로 리팩토링했습니다. 여백 공간(gap) 자체가 투명한 패딩 요소가 되어 마우스가 이동할 때 여전히 컨테이너(group) 안에 있는 것으로 인식되어 드롭다운이 사라지지 않습니다.

### 2.3 내보내기 HTML의 Mermaid 렌더링 지원
- **[수정] `js/file/file-handler.js`**
  - 마크다운을 HTML로 변환할 때 `wrapHTMLDocument()` 메서드 하단 `<script>` 태그를 삽입했습니다. 
  - 내보내기 결과물인 `.html` 파일 내부에서 자체적으로 웹의 `mermaid.min.js` CDN을 불러오고 렌더링하도록 DOMContentLoaded 이벤트를 구성했습니다. 따라서 추출된 파일을 열어도 다이어그램이 완벽하게 보입니다.

### 2.4 슬래시(/) 명령어 클릭 인식률 개선
- **[수정] `js/editor/slash-menu.js`**
  - 드롭다운 아이템의 이벤트 리스너를 단순한 `click` 에서 **`mousedown`** 으로 교체했습니다.
  - `mousedown` 시 `e.preventDefault()`를 선언함으로써 마우스 이벤트를 처리하는 동안 글을 작성하던 텍스트 영역(textarea)의 포커스가 잃어버리는 현상을 원천 방지했습니다. 이로 인해 명령어 실행이 씹히는 현상이 사라졌습니다.
