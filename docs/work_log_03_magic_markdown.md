# 작업 일지 (Work Log) - 03_magic_markdown.md
**작업일자:** 2026-02-26  
**작업자:** Blueprint(건축가), Relector(작업자), Doc(서기)

---

## 1. 개요 (Overview)
기존 마크다운 에디터에 강력한 AI 어시스턴트 기능을 부착하기 위해 `✨ AI 마법 정리 (Magic Markdown)` 기능 및 스크롤바 일원화 UI 패치를 진행했습니다. 사용자가 날것의 텍스트만 적더라도, 브라우저가 최신 AI 모델을 호출해 완벽한 마크다운 문서로 변환해 주는 것을 목표로 했습니다.

## 2. 주요 구현 내용 (Features Implemented)

### 2.1 스크롤바 일원화 (Single Scrollbar Layout)
*   **문제점:** 화면 전체 스크롤 1개, 에디터 내부 스크롤 1개, 미리보기 스크롤 1개 등 스크롤바가 중첩되어 긴 문서를 작성하거나 탐색할 때 사용성에 심각한 방해가 발생했습니다.
*   **해결 방법:**
    *   `index.html`의 CSS 구조에서 강제로 스크롤을 제한하던 `min-h-[600px]` 등의 하드코딩 높이를 제거했습니다.
    *   `app.js` 및 `editor-manager.js`의 `syncScroll` 동기화 메커니즘을 걷어내고, 에디터 영역(`textarea`) 입력 이벤트 발생 시 스크롤바 높이(scrollHeight)를 감지하여 자동으로 `height`를 키워주는 `autoResizeTextarea()` 함수를 구현했습니다.
    *   상단 툴바를 화면 스크롤 시에도 화면 최상단에 고정하기 위해 `sticky top-4 z-40` 클래스를 부여했습니다.

### 2.2 ✨ AI 마법 정리 (Magic Format) 도입
*   **설계(Blueprint):** 텍스트를 마크다운 포맷으로 변환하는 AI 기능 도입. 백엔드 없이 클라이언트(브라우저)에서 직접 AI 모델 API에 요청을 보내도록 설계.
*   **모델 선정:**
    1.  **Google Gemini (2.5 Flash Lite):** 개인 무료/가성비 최고 효율. (기본값)
    2.  **OpenAI (GPT-5 Mini):** 출력 품질의 표준.
*   **구현 로그(Relector):**
    *   `js/services/ai-service.js`를 신설하여 로컬 스토리지 키 관리 및 Fetch API를 이용한 외부 API 통신 모듈을 작성했습니다.
    *   시스템 프롬프트를 공통화하여 "헤딩, 리스트, 볼드/이탤릭체를 적극 활용하여 마크다운 포맷으로 구조화하라"는 명령을 AI에게 주입했습니다.
    *   `app.js`에 설정 창 전용 모달(UI Manager 연동)을 구축하고, 옵션(모델 선택, 키 2종 입력) 값을 저장하는 로직을 붙였습니다.
    *   `editor-manager.js`에 `magicFormat()` 함수를 추가해, 버튼 클릭 시 에디터 내용을 로드하여 `aiService`에 넘기고, 돌아온 결과물(````markdown 마크다운 제거 필터링 후)로 텍스트 교체 후 히스토리에 저장하는 파이프라인을 구축했습니다.
    *   `index.html` 상단 내 문서 영역 옆에 `⚙️ 설정` 버튼과 아이콘을 추가했고, 툴바의 첫 번째 순서에 푸른색 테두리로 강조된 `✨ AI 정리` 버튼을 삽입했습니다.
*   **버그 및 예외 처리(Fix):**
    *   단순히 버튼을 연동하는 데 그치지 않고, 사용자가 API 키를 입력하지 않고 기능을 호출할 경우 앱이 뻗는 대신 `ModalManager.alert`를 띄우고 "저장하기" 설정 패널로 자동 접근하도록 연결성(Flow)을 최적화했습니다.
    *   `ai-service.js` 작성 중 ES6 Template Literal(\`) 기호가 `write_to_file` 과정에서 Escape 되는 오류가 있었으나, `multi_replace_file_content`로 문법 버그를 교정했습니다.

## 3. 남은 과제 및 후속 계획 (Next Steps)
1.  **AI 기능 확장:** 현재는 순수한 "정리" 역할만 수행합니다. 추후 사용자가 특정 지시어('요약해줘', '번역해줘', '어조를 부드럽게 바꿔줘' 등)를 프롬프트로 넘길 수 있는 **사용자 지정 명령어 AI 포맷**을 추가로 개발할 수 있습니다.
2.  **모바일 최적화 점검:** 화면 스크롤이 단일화되었기 때문에, 모바일이나 태블릿 해상도에서도 툴바 고정(Sticky)과 스크롤 경험이 안정적인지 디바이스 테스트가 필요합니다.

---
*Generated by Antigravity (Scribe 📝) - 2026-02-26*
